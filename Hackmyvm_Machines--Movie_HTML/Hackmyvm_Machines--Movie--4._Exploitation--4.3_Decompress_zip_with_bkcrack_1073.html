<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.3 Decompress zip with "bkcrack"</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>4.3 Decompress zip with "bkcrack"</h1><br/><p></p><p>   A ZIP archive may contain many entries whose content can be compressed and/or encrypted. In particular, entries can be encrypted with a password-based symmetric encryption algorithm referred to as traditional PKWARE encryption, legacy encryption or ZipCrypto. This algorithm generates a pseudo-random stream of bytes (keystream) which is XORed to the entry&#39;s content (plaintext) to produce encrypted data (ciphertext). The generator&#39;s state, made of three 32-bits integers, is initialized using the password and then continuously updated with plaintext as encryption goes on. This encryption algorithm is vulnerable to known plaintext attacks as shown by Eli Biham and Paul C. Kocher in the research paper A known plaintext attack on the PKZIP stream cipher. Given ciphertext and 12 or more bytes of the corresponding plaintext, the internal state of the keystream generator can be recovered. This internal state is enough to decipher ciphertext entirely as well as other entries which were encrypted with the same password. It can also be used to bruteforce the password with a complexity of nl-6 where n is the size of the character set and l is the length of the password.</p><p></p><p>   More info about bkcrack clicking <a href="https://github.com/kimci86/bkcrack">here</a>.</p><p></p><p>1. With “7z” you can see the zip file&#39;s content.</p><p>    <div class="codebox"><pre>$ 7z l -slt mydata_archive.zip </pre></div></p><p></p><p>    <span style="color:#ffa500;">Output:</span></p><p>    <img src="images/1073-1.png" alt="images/1073-1.png" /></p><p>    </p><p>    There&#39;s a file called “sitemap.xml” on the victim&#39;s machine. </p><p>    </p><p>    </p><p>    </p><p>2. Navigate to <a href="http://192.168.12.69/sitemap.xml">http://192.168.12.69/sitemap.xml</a> and take a look at the “Source code”&gt;</p><p>    <img src="images/1073-2.png" alt="images/1073-2.png" /> </p><p></p><p>3. Create a file called “site.xml” with  the string &quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&quot;. </p><p>   <div class="codebox"><pre>$ nano site.xml</pre></div> </p><p></p><p>3. Compress the file to zip.</p><p>   <div class="codebox"><pre>$ <span style="color:#a52a2a;font-weight:700">zip</span> site.xml.zip site.xml</pre></div> </p><p></p><p>4. Download “<a href="https://github.com/kimci86/bkcrack/releases/download/v1.5.0/bkcrack-1.5.0-Linux.tar.gz">bkcrack</a>”.</p><p>   <div class="codebox"><pre>$ <span style="color:#a52a2a;font-weight:700">wget</span> https<span style="color:#a52a2a;font-weight:700">://</span>github.com<span style="color:#a52a2a;font-weight:700">/</span>kimci86<span style="color:#a52a2a;font-weight:700">/</span>bkcrack<span style="color:#a52a2a;font-weight:700">/</span>releases<span style="color:#a52a2a;font-weight:700">/</span>download<span style="color:#a52a2a;font-weight:700">/</span>v1.5.0<span style="color:#a52a2a;font-weight:700">/</span>bkcrack-1.5.0-Linux.tar.gz<br /></pre></div></p><p></p><p>5. Decompress the file.</p><p>    <div class="codebox"><pre>$ <span style="color:#a52a2a;font-weight:700">tar</span> -xf bkcrack-1.5.0-Linux.tar.gz<br /></pre></div></p><p></p><p>6. Run the followings command.</p><p>    <div class="codebox"><pre>$ ~<span style="color:#a52a2a;font-weight:700">/</span>movie<span style="color:#a52a2a;font-weight:700">/</span>bkcrack-1.5.0-Linux<span style="color:#a52a2a;font-weight:700">/</span>.<span style="color:#a52a2a;font-weight:700">/</span>bkcrack -C mydata_archive.zip -c sitemap.xml -P site.xml.zip -p site.xml<br /></pre></div></p><p>    <span style="color:#ffa500;">Output:</span></p><p>    <img src="images/1073-3.png" alt="images/1073-3.png" /></p><p>   </p><p>    <div class="codebox"><pre>$ ~<span style="color:#a52a2a;font-weight:700">/</span>movie<span style="color:#a52a2a;font-weight:700">/</span>bkcrack-1.5.0-Linux<span style="color:#a52a2a;font-weight:700">/</span>.<span style="color:#a52a2a;font-weight:700">/</span>bkcrack -C mydata_archive.zip -k d706e724 da372a68 a79864b0 -U output.zip password</pre></div></p><p>   </p><p>    <span style="color:#ffa500;">Output:</span>   </p><p>    <img src="images/1073-4.png" alt="images/1073-4.png" /></p><p>   </p><p>    A file called “output.zip” has been created with password “password”.</p><p></p><p>7. Decompress “output.zip”.</p><p>    <div class="codebox"><pre>$ <span style="color:#a52a2a;font-weight:700">unzip</span> output.zip </pre></div> </p><p>    <span style="color:#ffa500;">Output:</span></p><p>    <img src="images/1073-5.png" alt="images/1073-5.png" /></p><p></p><p>    There&#39;s a file called “id_rsa” which it&#39;ll help you connect via SSH as user “tarantino”.</p><p align="center"><img src="images/home.svg" height="22" width="22">  <a href="index.html">Index</a></p></div>
</body>
</html>
