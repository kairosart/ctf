<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.2 Injecting PHP module</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u>4.2 Injecting PHP module</u></b></h1><br />Let's install a PHP module on Drupal in order to inject code.<br /><br />a) Go to “Extend&gt;List&gt;Install new module”.<br /><br /><img src="images/339-1.png" alt="images/339-1.png" /> <br /><br />b) Download the PHP package for Drupal from the URL below and upload the tar file to install the new module.<br /><br /><a href="https://www.drupal.org/project/php">https://www.drupal.org/project/php</a><br /><br /><img src="images/339-2.png" alt="images/339-2.png" /><br /><br />c) After clicking on “+Install new module” you can upload your downloaded module (without descompress it).<br /><br /><img src="images/339-3.png" alt="images/339-3.png" /><br /><br />d) Enablee the module.<br /><br /><img src="images/339-4.png" alt="images/339-4.png" /><br /><br />e) Go to  Extend &gt;filters and enable the checkbox for PHP filters and click on “Install” at the bottom of the page.<br /><br /><img src="images/339-5.png" alt="images/339-5.png" /><br /><br />f) Inject a PHP script.<br /><br />Kali Linux has inbuilt PHP Scripts for utilizing them as a backdoor to assist Pen-testing work. They are stored inside /usr/share/webshells/php and a pen-tester can directory make use of them without wasting time in writing PHP code for the malicious script.<br /><br />PHP-reverse shell<br />It's a shellwhich will open an outbound  TCP connection from the webserver to a host . A shell will be attached to the TCP connection (reverse  TCP connection). You can run interactive programs such as telnet, ssh  etc with this script. It is different from the other Web shells script,  through which you can send a single command and then return the output.<br /><br />The file is ¨/usr/share/webshells/php/php-reverse-shell.php¨.<br /><br />g) Edit the file.<br /><br /><div class="codebox"><div class="codebox">$&nbsp;gedit&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>share<span style="color:#ff9d00;font-weight:700">/</span>webshells<span style="color:#ff9d00;font-weight:700">/</span>php<span style="color:#ff9d00;font-weight:700">/</span>php-reverse-shell.php</div></div><br /><br /><span style="color:#ffa500;">Output:</span><br /><img src="images/339-6.png" alt="images/339-6.png" /><br /><br /><br />h) Change the IP to your Kali Linux Machine IP (don't forget the quotes) and copy it to the clipboard.<br /><br />i) Execute netcat:<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$nc</span>&nbsp;-lvp&nbsp;1234</div></div><br /><br /><br />j) Create a “New Basic Page”. Go to “Content-&gt;”+Add content".<br /><br /><img src="images/339-7.png" alt="images/339-7.png" /><br /><br /><img src="images/339-8.png" alt="images/339-8.png" /><br /><br />k) Fill the new page content.<br /><br />    • Add a name.<br />    • Copy the code from your script in “Body” field.<br />    • Choose  “PHP Code” in “Text format”.<br />    • Click on “Preview”.<br /><br /><br /><img src="images/339-9.png" alt="images/339-9.png" />\<br /><br />h) You got a “PHP reverse shell”.<br /><br />On your Kali Machine you'll see the following output.<br /><br /><span style="color:#ffa500;">Output:</span><br /><img src="images/339-10.png" alt="images/339-10.png" /><br /><br />i) Introduce the following commands on the shell:<br /><br /><div class="codebox"><div class="codebox">python&nbsp;-c&nbsp;<span style="color:#3ad900;font-weight:400">'import&nbsp;pty;pty.spawn("/bin/bash")'</span><br /></div></div><br /><br /><span style="color:#ffa500;">Output:</span><br /><span style="background-color:#000000;">www-data@dc-7:/$ </span><br /><br />Now you can get into “/opt/script/backup.sh” <br /><br />j) Run.<br /><br /><div class="codebox"><div class="codebox">www-data@dc-7<span style="color:#ff9d00;font-weight:700">:/</span><span style="color:#7f0044;font-weight:400">$ls</span>&nbsp;-la&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>scripts</div></div><br /><br /><span style="color:#ffa500;">Output:</span><br /><img src="images/339-11.png" alt="images/339-11.png" /><br /><br />Now “www-data” user has all permissions to access or  modify “backups.sh”. You can therefore abuse the rights of the user file for  escalating privileges by modifying the contents of the source.<br /><p align="center"><img src="images/home.png" height="22" width="22">  <a href="index.html">Index</a></p></body></html>